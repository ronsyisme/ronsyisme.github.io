import{_ as B}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as i,e as c,b as l,d as U,r as d,j as L,u as r,c as _,F as R,x as A,h as D,q as P}from"./index-B48taLAI.js";import{h as j}from"./index-CdKRyxhG.js";import{i as b,a as E,b as F,c as M,d as z,e as N,f as O,g as S,h as V,j as $,k as Q,l as T,m as q}from"./13-BNWF6Dll.js";import"./readable-browser-S-mt8dif.js";import"./main-CFCDplcm.js";import"./index-BC8n2_ci.js";const G={},H={class:"animate-spin -ml-1 mr-3 h-5 w-5 text-[rgb(200,200,200)]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"};function J(y,g){return i(),c("svg",H,g[0]||(g[0]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))}const K=B(G,[["render",J],["__scopeId","data-v-9b952d4e"]]),W="/tg/static/png/0-BattQQoJ.png",X={class:"fixed top-0 left-0 px-6 py-4 w-full h-full overscroll-contain overflow-scroll-touch bg-white"},Y={class:"h-[180px]"},Z=["src"],tt={key:2,class:"text-[gray]"},et={class:"w-full mt-6 flex flex-wrap gap-4"},st=["onClick"],at=["src"],ot={class:"relative w-[200px] h-[200px]"},gt=U({__name:"photo",setup(y){const g=d([b,E,F,M,z,N,O,S,V,$,Q,T,q]),u=d(""),f=d(0),h=d(!1),p=d(!1);let w=W,s=null;const v=a=>{s=document.getElementById("myCanvas");const t=s.getContext("2d");s.width=200,s.height=200,t.clearRect(0,0,s.width,s.height);const e=2;s.style.width=s.width+"px",s.style.height=s.height+"px",s.width*=e,s.height*=e,t.scale(e,e),p.value=!0;const n=new Image;n.src=w,n.onload=function(){p.value=!1,t.save(),t.beginPath(),t.arc(100,100,100,0,2*Math.PI),t.closePath(),t.clip(),t.drawImage(n,0,0,s.width/2,s.height/2),t.restore();const o=new Image;o.src=a,o.onload=function(){t.fillStyle="rgba(233,233,233,1)",t.beginPath(),t.arc(s.width/2-24,24,24,0,Math.PI*2),t.fill(),t.drawImage(o,s.width/2-48,0,48,48)}}},x=()=>{const a=document.createElement("a");a.href=s.toDataURL("image/png"),a.download=parseInt(new Date().getTime()/1e3+"")+".png",document.body.appendChild(a),a.click(),document.body.removeChild(a)},I=async a=>{const{status:t,data:e}=await j.post("https://laikadog.games:8443/api/tg/getOriginAvatar",{data:{userId:Number(a)}});return t===200&&e&&e.imgBase64?e.imgBase64:""},C=a=>{const t=atob(a),e=t.length,n=new Uint8Array(e);for(let m=0;m<e;m++)n[m]=t.charCodeAt(m);const o=new Blob([n],{type:"image/png"});w=URL.createObjectURL(o)},k=async()=>{const a=decodeURIComponent(decodeURIComponent(document.URL));console.log("decodeUrl",a);const t=/user=\{"id":(\d+),/,e=a.match(t);if(e&&e[1]){const n=e[1];console.log("User ID:",n),h.value=!0;const o=await I(n);h.value=!1,o&&(u.value="data:image/png;base64,"+o,C(o)),v(b)}else console.log("User ID not found.")};return L(()=>{k()}),(a,t)=>{const e=K;return i(),c("div",X,[t[1]||(t[1]=l("p",{class:"mb-2"},"Origin",-1)),l("div",Y,[r(u)?(i(),c("img",{key:0,class:"max-w-full max-h-[200px]",src:r(u),alt:"avatar"},null,8,Z)):r(h)?(i(),_(e,{key:1})):(i(),c("div",tt,"未获取到用户头像"))]),t[2]||(t[2]=l("div",{class:"mb-2"},"Select",-1)),l("div",et,[(i(!0),c(R,null,A(r(g),(n,o)=>(i(),c("div",{class:P({"bg-gray-200":r(f)===o}),onClick:m=>(f.value=o,v(n))},[(i(),c("img",{class:"w-14 h-14",src:n,alt:"",key:o},null,8,at))],10,st))),256))]),t[3]||(t[3]=l("p",{class:"mt-6 mb-2"},"Generate",-1)),l("div",ot,[t[0]||(t[0]=l("canvas",{id:"myCanvas",width:"200",height:"200"},null,-1)),r(p)?(i(),_(e,{key:0,class:"absolute left-0 top-0"})):D("",!0)]),l("div",{class:"mt-10 w-20 h-8 bg-gray-500 flex justify-center items-center text-white hover:cursor-pointer",onClick:x},"下载")])}}});export{gt as default};
