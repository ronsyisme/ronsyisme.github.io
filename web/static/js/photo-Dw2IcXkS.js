import{i as B,a as C,b as U,c as L,d as R,e as D,f as A,g as P,h as E,j as F,k as M,_ as N,l as j}from"./13-Cje5FruW.js";import{i as v,a as O,b as S}from"./3-DpKs4-qw.js";import{d as T,n as g,i as V,o as i,b as c,e as l,q as r,M as b,F as q,r as z,N as G,B as $}from"./index-D8hugNrX.js";import"./plugin-vue_export-helper-DlAUqK2U.js";const H={class:"fixed top-0 left-0 px-6 py-4 w-full h-full overscroll-contain overflow-scroll-touch bg-white"},J={class:"h-[180px]"},K=["src"],Q={key:2,class:"text-[gray]"},W={class:"w-full mt-6 flex flex-wrap gap-4"},X=["onClick"],Y=["src"],Z={class:"relative w-[200px] h-[200px]"},ne=T({__name:"photo",setup(ee){const y=g([v,O,S,B,C,U,L,R,D,A,P,E,F]),m=g(""),p=g(0),u=g(!1),h=g(!1);let f=j,a=null;const w=s=>{a=document.getElementById("myCanvas");const e=a.getContext("2d");a.width=200,a.height=200,e.clearRect(0,0,a.width,a.height);const t=2;a.style.width=a.width+"px",a.style.height=a.height+"px",a.width*=t,a.height*=t,e.scale(t,t),h.value=!0;const n=new Image;n.src=f,n.onload=function(){h.value=!1,e.save(),e.beginPath(),e.arc(100,100,100,0,2*Math.PI),e.closePath(),e.clip(),e.drawImage(n,0,0,a.width/2,a.height/2),e.restore();const o=new Image;o.src=s,o.onload=function(){e.fillStyle="rgba(233,233,233,1)",e.beginPath(),e.arc(a.width/2-24,24,24,0,Math.PI*2),e.fill(),e.drawImage(o,a.width/2-48,0,48,48)}}},_=()=>{const s=document.createElement("a");s.href=a.toDataURL("image/png"),s.download=parseInt(new Date().getTime()/1e3+"")+".png",document.body.appendChild(s),s.click(),document.body.removeChild(s)},x=async s=>{const{status:e,data:t}=await M.post("https://laikadog.games:8443/api/tg/getOriginAvatar",{data:{userId:Number(s)}});return e===200&&t&&t.imgBase64?t.imgBase64:""},I=s=>{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let d=0;d<t;d++)n[d]=e.charCodeAt(d);const o=new Blob([n],{type:"image/png"});f=URL.createObjectURL(o)},k=async()=>{const s=decodeURIComponent(decodeURIComponent(document.URL));console.log("decodeUrl",s);const e=/user=\{"id":(\d+),/,t=s.match(e);if(t&&t[1]){const n=t[1];console.log("User ID:",n),u.value=!0;const o=await x(n);u.value=!1,o&&(m.value="data:image/png;base64,"+o,I(o)),w(v)}else console.log("User ID not found.")};return V(()=>{k()}),(s,e)=>{const t=N;return i(),c("div",H,[e[1]||(e[1]=l("p",{class:"mb-2"},"Origin",-1)),l("div",J,[r(m)?(i(),c("img",{key:0,class:"max-w-full max-h-[200px]",src:r(m),alt:"avatar"},null,8,K)):r(u)?(i(),b(t,{key:1})):(i(),c("div",Q,"未获取到用户头像"))]),e[2]||(e[2]=l("div",{class:"mb-2"},"Select",-1)),l("div",W,[(i(!0),c(q,null,z(r(y),(n,o)=>(i(),c("div",{class:$({"bg-gray-200":r(p)===o}),onClick:d=>(p.value=o,w(n))},[(i(),c("img",{class:"w-14 h-14",src:n,alt:"",key:o},null,8,Y))],10,X))),256))]),e[3]||(e[3]=l("p",{class:"mt-6 mb-2"},"Generate",-1)),l("div",Z,[e[0]||(e[0]=l("canvas",{id:"myCanvas",width:"200",height:"200"},null,-1)),r(h)?(i(),b(t,{key:0,class:"absolute left-0 top-0"})):G("",!0)]),l("div",{class:"mt-10 w-20 h-8 bg-gray-500 flex justify-center items-center text-white hover:cursor-pointer",onClick:_},"下载")])}}});export{ne as default};
