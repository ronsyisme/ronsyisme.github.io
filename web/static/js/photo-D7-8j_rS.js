import{i as B,a as C,b as L,c as U,d as A,e as D,f as E,g as P,h as R,j as S,k as F,_ as M,l as N}from"./13-Cje5FruW.js";import{i as v,a as j,b as O}from"./3-DpKs4-qw.js";import{d as T,n as m,i as G,o as i,b as r,e as l,q as c,M as b,F as V,r as q,N as z,B as $}from"./index-D8hugNrX.js";import"./plugin-vue_export-helper-DlAUqK2U.js";const H={class:"fixed top-0 left-0 px-6 py-4 w-full h-full overscroll-contain overflow-scroll-touch bg-white"},J={class:"h-[180px]"},K=["src"],Q={key:2,class:"text-[gray]"},W={class:"w-full mt-6 flex flex-wrap gap-4"},X=["onClick"],Y=["src"],Z={class:"relative w-[200px] h-[200px]"},ot=T({__name:"photo",setup(tt){const _=m([v,j,O,B,C,L,U,A,D,E,P,R,S]),d=m(""),p=m(0),u=m(!1),h=m(!1);let f=N,e=null;const w=a=>{e=document.getElementById("myCanvas");const t=e.getContext("2d");e.width=200,e.height=200,t.clearRect(0,0,e.width,e.height);const s=2;e.style.width=e.width+"px",e.style.height=e.height+"px",e.width*=s,e.height*=s,t.scale(s,s),h.value=!0;const n=new Image;n.src=f,n.onload=function(){h.value=!1,t.save(),t.beginPath(),t.arc(100,100,100,0,2*Math.PI),t.closePath(),t.clip(),t.drawImage(n,0,0,e.width/2,e.height/2),t.restore();const o=new Image;o.src=a,o.onload=function(){t.fillStyle="rgba(233,233,233,1)",t.beginPath(),t.arc(e.width/2-24,24,24,0,Math.PI*2),t.fill(),t.drawImage(o,e.width/2-48,0,48,48)}}},y=()=>{const a=document.createElement("a");a.href=e.toDataURL("image/png"),a.download=parseInt(new Date().getTime()/1e3+"")+".png",document.body.appendChild(a),a.click(),document.body.removeChild(a)},x=async a=>{const{status:t,data:s}=await F.post("https://laikadog.games:8443/api/tg/getOriginAvatar",{data:{userId:Number(a)}});return t===200&&s&&s.imgBase64?s.imgBase64:""},I=a=>{const t=atob(a),s=t.length,n=new Uint8Array(s);for(let g=0;g<s;g++)n[g]=t.charCodeAt(g);const o=new Blob([n],{type:"image/png"});f=URL.createObjectURL(o)},k=async()=>{const a=localStorage.getItem("TG_USER_ID");if(a){u.value=!0;const t=await x(a);u.value=!1,t&&(d.value="data:image/png;base64,"+t,I(t)),w(v)}};return G(()=>{k()}),(a,t)=>{const s=M;return i(),r("div",H,[t[1]||(t[1]=l("p",{class:"mb-2"},"Origin",-1)),l("div",J,[c(d)?(i(),r("img",{key:0,class:"max-w-full max-h-[200px]",src:c(d),alt:"avatar"},null,8,K)):c(u)?(i(),b(s,{key:1})):(i(),r("div",Q,"未获取到用户头像"))]),t[2]||(t[2]=l("div",{class:"mb-2"},"Select",-1)),l("div",W,[(i(!0),r(V,null,q(c(_),(n,o)=>(i(),r("div",{class:$({"bg-gray-200":c(p)===o}),onClick:g=>(p.value=o,w(n))},[(i(),r("img",{class:"w-14 h-14",src:n,alt:"",key:o},null,8,Y))],10,X))),256))]),t[3]||(t[3]=l("p",{class:"mt-6 mb-2"},"Generate",-1)),l("div",Z,[t[0]||(t[0]=l("canvas",{id:"myCanvas",width:"200",height:"200"},null,-1)),c(h)?(i(),b(s,{key:0,class:"absolute left-0 top-0"})):z("",!0)]),l("div",{class:"mt-10 w-20 h-8 bg-gray-500 flex justify-center items-center text-white hover:cursor-pointer",onClick:y},"下载")])}}});export{ot as default};
